#!/bin/bash

# ğŸš€ æ—¥æœ¬æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ« v5.0 - æœ€é©åŒ–ç‰ˆ èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# è»½é‡ã§é«˜é€Ÿãªæ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ«

echo "=== ğŸš€ æ—¥æœ¬æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ« v5.0 - æœ€é©åŒ–ç‰ˆ èµ·å‹•ä¸­ ==="

# ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
if [ -d "venv" ]; then
    echo "ä»®æƒ³ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆä¸­..."
    source venv/bin/activate
else
    echo "è­¦å‘Š: ä»®æƒ³ç’°å¢ƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    echo "ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ã¦ãã ã•ã„: python3 -m venv venv"
    exit 1
fi

# å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
echo "å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆä¸­..."
mkdir -p logs
mkdir -p cache
mkdir -p styles

# ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
echo "ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
python -c "import streamlit, pandas, plotly, yfinance" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
    pip install -r requirements.txt
fi

# ãƒãƒ¼ãƒˆè¨­å®š
PORT=${1:-8501}

echo "ãƒãƒ¼ãƒˆ ${PORT} ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ä¸­..."
echo "ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:${PORT} ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„"

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
streamlit run app.py --server.port ${PORT} --server.headless false

echo "=== ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº† ==="